<div class="page-wrapper">
  @if (tripItem) {
    <p-button icon="pi pi-chevron-left" [rounded]="true" [text]="true" (onClick)="goBack()" />
    <h1 class="title">Book your trip from {{ tripItem.tripStartStation }} to {{ tripItem.tripEndStation }}</h1>
    <h2 class="ride-id">Ride {{ tripItem.rideId }}</h2>
    <div class="item-wrapper">
      <div class="item">
        <app-trip-timeline
          [departureDate]="tripItem.tripDepartureDate"
          [arrivalDate]="tripItem.tripArrivalDate"
          [startStation]="tripItem.tripStartStation"
          [endStation]="tripItem.tripEndStation"
        ></app-trip-timeline>
      </div>
      <p-button #buttonElement class="route-button" label="Route" text (click)="openModal()">
        <i class="material-icons">route</i>
      </p-button>
    </div>

    <p-tabView [scrollable]="true" (onChange)="onTabChange($event)">
      @for (tab of takeTabsCarriageType(); track $index) {
        <p-tabPanel>
          <ng-template pTemplate="header">
            <div class="tab-container">
              <div class="tab-title-carriage-type">
                {{ tab.name }}
              </div>
              <div class="tab-title-price">
                {{ getPrice(tab.type) | currency: 'USD' : 'symbol' : '1.0-0' }}
              </div>

              @let seatsNumber = getFreeSeatsNumber(tab.type);
              @if (!seatsNumber) {
                <div class="seat-count">(no seats)</div>
              } @else {
                <div class="seat-count">({{ seatsNumber }} {{ seatsNumber === 1 ? 'seat' : 'seats' }})</div>
              }
            </div>
          </ng-template>
          <app-train-carriages-list></app-train-carriages-list>
        </p-tabPanel>
      }
    </p-tabView>
  }
</div>

<ng-template #modalContent>
  <app-trip-details [trip]="tripItem"></app-trip-details>
</ng-template>
